**归一化流（Normalizing Flow）**领域，它体现的是**变量变换下概率密度的变化关系**，也叫**变换概率密度公式**的离散形式。

---

## 公式内容拆解

### 1. 公式拆分

$$
p_{\text{base}}(\mathbf{z}') \Delta z_1 \Delta z_2 = p(\mathbf{x}') \left| \det \begin{bmatrix} \Delta x_{11} & \Delta x_{21} \\ \Delta x_{12} & \Delta x_{22} \end{bmatrix} \right|

$$

### 2. 各符号含义

- **$p_{\text{base}}(\mathbf{z}')$**：基础分布（通常是高斯分布）在点$\mathbf{z}'$处的概率密度。: z表示一个确定的点，z片是一个微小的片段
- **$\Delta z_1, \Delta z_2$**：$\mathbf{z}$空间的微元（小区间），表示体积元素。
- **$p(\mathbf{x}')$**：目标分布（复杂分布）在点$\mathbf{x}'$处的概率密度。
- **$\Delta x_{ij}$**：变换到$\mathbf{x}$空间后微元的变化情况。
- **$\left| \det [...] \right|$**：雅可比行列式绝对值，描述体积在变换下如何伸缩**$\left| \det [...] \right|$**：雅可比行列式绝对值，描述体积在变换下如何伸。
- x = G(z), G is generator
- **z 是“原因”，x 是“结果”；z 是低维简单分布采样得到的潜在表示，x 是高维复杂观测数据，两者通过生成器建立联系。学习的目标就是：用简单的 z 分布+强大的生成器，产生复杂的数据 x。**

---

## 物理/直观理解

- **变量变换下的概率密度公式**:

  - 假设你把一个2D小方块$\Delta z_1 \times \Delta z_2$映射到$x$空间，它就变成了一个**小平行四边形**。
  - 这个平行四边形体积=“雅可比行列式”描述的量。
  - 为了概率守恒，概率密度需要“缩放”以补偿体积的变化，因此出现了$\left| \det J \right|$一项。
- **公式实际描述**

  - $\mathbf{z}$空间的小概率质量（概率密度 $\times$ 小体积）和$\mathbf{x}$空间的概率质量是相等的。
  - 这是多变量概率论和Normalizing Flow理论的根基。

---

## 对应连续版本的对比

- **连续情况（常见的雅可比变换）**
  $$
  p_{\text{base}}(\mathbf{z}) = p(\mathbf{x}) \cdot \left| \det \left(\frac{\partial \mathbf{x}}{\partial \mathbf{z}}\right) \right|

  $$
- 你的公式其实是对上述连续公式的**离散近似表达**。

---

## 总结

- **用途**：告诉我们如何用一个简单分布（比如高斯或均匀分布）通过可逆变换变为一个复杂分布，并精确计算概率密度。
- **归一化流的关键公式**：密度的可逆计算与采样。
- **离散视角**：学习复杂分布可从基础分布采样，再通过可逆变换和雅可比调整密度。
- **z 是“原因”，x 是“结果”；z 是低维简单分布采样得到的潜在表示，x 是高维复杂观测数据，两者通过生成器建立联系。学习的目标就是：用简单的 z 分布+强大的生成器，产生复杂的数据 x。**

---


思考：P(z) is what?

因为在概率论里，概率密度函数 $p(z)$ 在某一区间（或小区域）内的积分，给出的就是**随机变量落在这个区间里的概率** 。

* 对于一维，

  $$
  P(a < z < b) = \int_a^b p(z),dz

  $$
* 对于二维，

  $$
  P(\mathbf{z} \in S) = \iint_S p(\mathbf{z}),d\mathbf{z}

  $$

  其中 $S$ 是某个区域。

---

## 2. 和小区域的近似

* 当$\Delta z_1$、$\Delta z_2$很小时，在$z'$附近，小方块$[z_1', z_1'+\Delta z_1]\times[z_2', z_2'+\Delta z_2]$内的概率近似为：

  $$
  P \approx p_{\text{base}}(\mathbf{z}') \cdot \Delta z_1 \Delta z_2

  $$

  这其实是把积分用“微元”（非常小的面积块）近似成了“密度×面积”。

---

## 3. 一句话总结

> **你完全可以把 $p_{\text{base}}(\mathbf{z}'),\Delta z_1,\Delta z_2$ 理解为对二维高斯分布在该小矩形区间上做积分的近似** 。就是做了一个“定积分”，但在面积很小的时候，积分近似等于“密度×面积”。
