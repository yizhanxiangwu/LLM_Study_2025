* Normalizing flows
* Continuous Normalizing flows
* Flow Matching
* Scaling

**归一化流（Normalizing Flow）**领域，它体现的是**变量变换下概率密度的变化关系**，也叫**变换概率密度公式**的离散形式。

---

## 公式内容拆解

### 1. 公式拆分

$$
p_{\text{base}}(\mathbf{z}') \Delta z_1 \Delta z_2 = p(\mathbf{x}') \left| \det \begin{bmatrix} \Delta x_{11} & \Delta x_{21} \\ \Delta x_{12} & \Delta x_{22} \end{bmatrix} \right|

$$

### 2. 各符号含义

- **$p_{\text{base}}(\mathbf{z}')$**：基础分布（通常是高斯分布）在点$\mathbf{z}'$处的概率密度。
- **$\Delta z_1, \Delta z_2$**：$\mathbf{z}$空间的微元（小区间），表示体积元素。
- **$p(\mathbf{x}')$**：目标分布（复杂分布）在点$\mathbf{x}'$处的概率密度。
- **$\Delta x_{ij}$**：变换到$\mathbf{x}$空间后微元的变化情况。
- **$\left| \det [...] \right|$**：雅可比行列式绝对值，描述体积在变换下如何伸缩。

---

## 物理/直观理解

- **变量变换下的概率密度公式**:

  - 假设你把一个2D小方块$\Delta z_1 \times \Delta z_2$映射到$x$空间，它就变成了一个**小平行四边形**。
  - 这个平行四边形体积=“雅可比行列式”描述的量。
  - 为了概率守恒，概率密度需要“缩放”以补偿体积的变化，因此出现了$\left| \det J \right|$一项。
- **公式实际描述**

  - $\mathbf{z}$空间的小概率质量（概率密度 $\times$ 小体积）和$\mathbf{x}$空间的概率质量是相等的。
  - 这是多变量概率论和Normalizing Flow理论的根基。

---

## 对应连续版本的对比

- **连续情况（常见的雅可比变换）**
  $$
  p_{\text{base}}(\mathbf{z}) = p(\mathbf{x}) \cdot \left| \det \left(\frac{\partial \mathbf{x}}{\partial \mathbf{z}}\right) \right|

  $$
- 你的公式其实是对上述连续公式的**离散近似表达**。

---

## 总结

- **用途**：告诉我们如何用一个简单分布（比如高斯或均匀分布）通过可逆变换变为一个复杂分布，并精确计算概率密度。
- **归一化流的关键公式**：密度的可逆计算与采样。
- **离散视角**：学习复杂分布可从基础分布采样，再通过可逆变换和雅可比调整密度。

---

每个**生成模型**理想情况下都是一个**密度估计器**；因此，它会建模一个概率密度，最终是一个**联合概率分布**（JPD），具有两个**预期特性**，即采样和压缩。压缩基本上是将数据推送到信息空间，这看起来维度更低，而采样则是从任何特征分布（z）开始生成 P(x|z) 的能力，可以是正态分布（如在变分自编码器（VAE）的情况下），因此，从非常高的层面来看，我们试图找到一个映射/函数，将 z 映射到 x 以及 x 映射到 z（采样和压缩）。
